<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>F1 Reaction Test | Wide Track</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Titillium+Web:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        /* 기본: 싱가포르 나이트 모드 */
        --bg-sky: #050508;
        --bg-track: #151515;
        --neon-accent: #00ffcc;
        --text-color: #fff;
        --light-off: #222;
        --light-red: #ff0000;
        --light-red-glow: 0 0 30px #ff0000, 0 0 60px #ff0000;
        --cockpit-border: #000;
      }

      body.day-mode {
        /* 낮 모드 */
        --bg-sky: #87ceeb;
        --bg-track: #3a3a3a;
        --neon-accent: #ffffff;
        --text-color: #fff;
        --light-off: #3a3a3a;
        --light-red: #ff0000;
        --light-red-glow: 0 0 10px #ff0000;
        --cockpit-border: #111;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        user-select: none;
      }

      body {
        font-family: "Titillium Web", sans-serif;
        height: 100vh;
        width: 100vw;
        overflow: hidden;
        background-color: var(--bg-sky);
        color: var(--text-color);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        transition: background-color 0.5s ease;
      }

      /* --- 배경 (넓은 트랙) --- */
      .world-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        perspective: 600px;
        z-index: 1;
        overflow: hidden;
      }

      .sky {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 50%;
        background: linear-gradient(
          to bottom,
          var(--bg-sky) 0%,
          transparent 100%
        );
      }

      .track-surface {
        position: absolute;
        bottom: -20%;
        left: 50%;
        width: 400%; /* 넓은 시야 */
        height: 100%;
        transform: translateX(-50%) rotateX(80deg);
        background: radial-gradient(
          circle at 50% 0%,
          #333 0%,
          var(--bg-track) 60%
        );
        box-shadow: inset 0 0 100px #000;
        clip-path: polygon(45% 0%, 55% 0%, 100% 100%, 0% 100%);
      }

      .track-lines::before,
      .track-lines::after {
        content: "";
        position: absolute;
        top: 0;
        bottom: 0;
        width: 20px;
        background: var(--neon-accent);
        box-shadow: 0 0 20px var(--neon-accent);
      }
      .track-lines::before {
        left: 10%;
      }
      .track-lines::after {
        right: 10%;
      }

      .center-line {
        position: absolute;
        top: 0;
        bottom: 0;
        left: 50%;
        width: 4px;
        background: repeating-linear-gradient(
          to bottom,
          rgba(255, 255, 255, 0.3) 0%,
          rgba(255, 255, 255, 0.3) 10%,
          transparent 10%,
          transparent 20%
        );
        transform: translateX(-50%);
        opacity: 0.5;
      }

      /* --- 콕핏 바이저 --- */
      .cockpit-visor {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 100;
        pointer-events: none;
        background: radial-gradient(
          ellipse at center,
          transparent 50%,
          rgba(0, 0, 0, 0.4) 60%,
          var(--cockpit-border) 80%
        );
      }
      .cockpit-visor::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 15%;
        background: var(--cockpit-border);
        border-bottom: 4px solid #222;
        border-bottom-left-radius: 50% 30%;
        border-bottom-right-radius: 50% 30%;
      }
      .cockpit-visor::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 25%;
        background: var(--cockpit-border);
        border-top: 4px solid #222;
        border-top-left-radius: 40% 30%;
        border-top-right-radius: 40% 30%;
      }

      /* --- UI 요소 --- */
      .game-ui {
        position: relative;
        z-index: 200;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding-top: 12vh;
        width: 100%;
        height: 100%;
      }

      .page-title {
        position: absolute;
        top: 25px;
        left: 25px;
        font-family: "Orbitron";
        font-weight: 700;
        color: var(--neon-accent);
        text-shadow: 0 0 10px rgba(0, 255, 204, 0.3);
      }

      .gantry {
        display: flex;
        gap: 12px;
        background: #111;
        padding: 15px 25px;
        border-radius: 12px;
        border: 2px solid #333;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);
        margin-bottom: 20px;
        transform: perspective(800px) rotateX(10deg);
      }

      .light-pod {
        display: flex;
        flex-direction: column;
        gap: 6px;
        background: #000;
        padding: 6px;
        border-radius: 6px;
        border: 1px solid #333;
      }

      .light {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        background: var(--light-off);
        border: 2px solid #000;
        transition: background-color 0.05s, box-shadow 0.05s;
      }

      /* 불 들어왔을 때 클래스 */
      .light.on {
        background-color: var(--light-red);
        box-shadow: var(--light-red-glow);
      }

      .info-panel {
        height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 20px;
      }
      .status-message {
        font-family: "Orbitron";
        font-size: 3.5rem;
        font-weight: 700;
        text-shadow: 2px 2px 0 #000;
      }
      .status-message.success {
        color: #00ff00;
        text-shadow: 0 0 25px #00ff00;
      }
      .status-message.penalty {
        color: #ff0000;
        text-shadow: 0 0 25px #ff0000;
        animation: shake 0.4s;
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-10px);
        }
        75% {
          transform: translateX(10px);
        }
      }

      .launch-btn {
        background: linear-gradient(145deg, #222, #000);
        color: #fff;
        border: 2px solid #444;
        padding: 18px 50px;
        border-radius: 50px;
        font-family: "Orbitron";
        font-size: 1.4rem;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
        transition: all 0.1s;
      }
      .launch-btn:active {
        transform: translateY(2px);
      }
      .launch-btn:hover {
        border-color: var(--neon-accent);
        color: var(--neon-accent);
      }

      /* 테마 토글 */
      .theme-toggle {
        position: absolute;
        top: 25px;
        right: 25px;
        display: flex;
        align-items: center;
        gap: 10px;
        background: rgba(0, 0, 0, 0.6);
        padding: 6px 12px;
        border-radius: 20px;
        border: 1px solid #444;
        cursor: pointer;
      }
      .toggle-switch {
        width: 36px;
        height: 18px;
        background: #333;
        border-radius: 10px;
        position: relative;
      }
      .toggle-knob {
        width: 14px;
        height: 14px;
        background: #fff;
        border-radius: 50%;
        position: absolute;
        top: 2px;
        left: 2px;
        transition: 0.3s;
      }
      body.day-mode .toggle-switch {
        background: #ff0000;
      }
      body.day-mode .toggle-knob {
        transform: translateX(18px);
      }
      .toggle-label {
        font-size: 0.7rem;
        font-weight: bold;
      }
      /* --- 사이드 배리어 (화려한 싱가포르 스타일) --- */
      .barrier-left,
      .barrier-right {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 300px;
        background: repeating-linear-gradient(
          to bottom,
          #222 0%,
          #222 40%,
          #444 40%,
          #444 50%
        );
        transform-origin: center;
        box-shadow: 0 0 20px rgba(0, 255, 204, 0.2);
      }
      .barrier-left {
        left: -25%;
        transform: rotateY(90deg) translateX(50%);
        border-right: 4px solid var(--neon-accent);
        border-left: 2px solid #ff00de; /* 마젠타 포인트 */
      }
      .barrier-right {
        right: -25%;
        transform: rotateY(-90deg) translateX(-50%);
        border-left: 4px solid var(--neon-accent);
        border-right: 2px solid #ff00de; /* 마젠타 포인트 */
      }

      /* --- 전광판 (Billboards - Real Sponsors) --- */
      .billboard {
        position: absolute;
        width: 140px; height: 50px;
        background: #000;
        border: 2px solid #fff;
        box-shadow: 0 0 25px rgba(255, 255, 255, 0.4);
        color: #fff;
        font-family: "Titillium Web", sans-serif; /* F1 Font Style */
        font-weight: 900;
        font-size: 1.1rem;
        display: flex; align-items: center; justify-content: center;
        transform-style: preserve-3d;
        text-align: center;
        line-height: 1;
        letter-spacing: 1px;
      }
      
      /* Sponsor Specific Styles - More Vibrant for Night Race */
      .sponsor-sia { background: #002561; color: #fcae1d; border-color: #fcae1d; box-shadow: 0 0 40px rgba(252, 174, 29, 0.8); }
      .sponsor-rolex { background: #006039; color: #ffd700; border-color: #ffd700; box-shadow: 0 0 40px rgba(255, 215, 0, 0.8); }
      .sponsor-dhl { background: #ffcc00; color: #d40511; border-color: #d40511; box-shadow: 0 0 40px rgba(212, 5, 17, 0.8); }
      .sponsor-heineken { background: #008200; color: #fff; border-color: #ff0000; box-shadow: 0 0 40px rgba(0, 130, 0, 0.8); }
      .sponsor-aramco { background: #00a3e0; color: #fff; border-color: #88d750; box-shadow: 0 0 40px rgba(0, 163, 224, 0.8); }
      .sponsor-pirelli { background: #d52b1e; color: #fff; border-color: #ffd700; box-shadow: 0 0 40px rgba(213, 43, 30, 0.8); }

      /* Positions - Adjusted for Cockpit Perspective */
      .left-1 { top: 15%; left: 12%; transform: rotateY(70deg); }
      .right-1 { top: 15%; right: 12%; transform: rotateY(-70deg); }
      .left-2 { top: 30%; left: 8%; transform: rotateY(70deg) scale(0.9); }
      .right-2 { top: 30%; right: 8%; transform: rotateY(-70deg) scale(0.9); }
      .left-3 { top: 45%; left: 5%; transform: rotateY(70deg) scale(0.8); }
      .right-3 { top: 45%; right: 5%; transform: rotateY(-70deg) scale(0.8); }

      /* --- 강력한 조명 효과 (싱가포르 스타일 - Extreme Brightness) --- */
      .floodlight-glow {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background: radial-gradient(circle at 50% 20%, rgba(255, 255, 255, 0.3) 0%, transparent 80%);
        pointer-events: none;
        mix-blend-mode: screen;
      }

      .overhead-lights {
        position: absolute;
        top: 0; left: 0; width: 100%; height: 60%;
        perspective: 600px; pointer-events: none;
      }
      
      /* Main Track Lights (Overhead) - More Intense */
      .light-beam {
        position: absolute;
        top: 0; left: 50%; transform: translateX(-50%);
        width: 180%; height: 10px;
        background: #fff;
        box-shadow: 0 0 100px 40px rgba(255, 255, 255, 1.0), 0 0 150px 60px rgba(200, 220, 255, 0.6);
        border-radius: 50%;
      }
      .lb-1 { top: 8%; opacity: 0.6; width: 80%; }
      .lb-2 { top: 18%; opacity: 0.8; width: 90%; }
      .lb-3 { top: 28%; opacity: 0.9; width: 100%; }
      .lb-4 { top: 38%; opacity: 1.0; width: 110%; }
      .lb-5 { top: 48%; opacity: 1.0; width: 120%; }
      .lb-6 { top: 58%; opacity: 1.0; width: 130%; }

      /* Side Floodlights (Illuminating Barriers) - Brighter */
      .side-light {
        position: absolute;
        width: 250px; height: 250px;
        background: radial-gradient(circle, rgba(255,255,255,0.6) 0%, transparent 70%);
        mix-blend-mode: screen;
      }
      .sl-left-1 { top: 10%; left: -10%; }
      .sl-right-1 { top: 10%; right: -10%; }
      .sl-left-2 { top: 30%; left: -5%; }
      .sl-right-2 { top: 30%; right: -5%; }
    </style>
  </head>
  <body>
    <div class="world-container">
      <div class="sky"></div>
      <div class="track-surface">
        <div class="track-lines"></div>
        <div class="center-line"></div>
      </div>

      <!-- Side Barriers -->
      <div class="barrier-left"></div>
      <div class="barrier-right"></div>

      <!-- Billboards (Real Singapore GP Sponsors) -->
      <div class="billboard left-1 sponsor-sia"><span>SINGAPORE AIRLINES</span></div>
      <div class="billboard right-1 sponsor-rolex"><span>ROLEX</span></div>
      <div class="billboard left-2 sponsor-dhl"><span>DHL</span></div>
      <div class="billboard right-2 sponsor-heineken"><span>Heineken</span></div>
      <div class="billboard left-3 sponsor-aramco"><span>aramco</span></div>
      <div class="billboard right-3 sponsor-pirelli"><span>PIRELLI</span></div>

      <!-- Powerful Floodlights (Singapore Brightness) -->
      <div class="floodlight-glow"></div>
      <div class="overhead-lights">
        <!-- Main Track Lights -->
        <div class="light-beam lb-1"></div>
        <div class="light-beam lb-2"></div>
        <div class="light-beam lb-3"></div>
        <div class="light-beam lb-4"></div>
        <div class="light-beam lb-5"></div>
        <div class="light-beam lb-6"></div>
        
        <!-- Side Floodlights (Illuminating Barriers) -->
        <div class="side-light sl-left-1"></div>
        <div class="side-light sl-right-1"></div>
        <div class="side-light sl-left-2"></div>
        <div class="side-light sl-right-2"></div>
      </div>
    </div>

    <div class="cockpit-visor"></div>
    <div class="page-title">F1 REACTION TEST</div>

    <div class="theme-toggle" id="themeToggle">
      <span class="toggle-label">MODE</span>
      <div class="toggle-switch"><div class="toggle-knob"></div></div>
    </div>

    <div class="game-ui">
      <div class="info-panel">
        <div id="status" class="status-message"></div>
      </div>

      <div class="gantry">
        <div class="light-pod">
          <div class="light"></div>
          <div class="light"></div>
        </div>
        <div class="light-pod">
          <div class="light"></div>
          <div class="light"></div>
        </div>
        <div class="light-pod">
          <div class="light"></div>
          <div class="light"></div>
        </div>
        <div class="light-pod">
          <div class="light"></div>
          <div class="light"></div>
        </div>
        <div class="light-pod">
          <div class="light"></div>
          <div class="light"></div>
        </div>
      </div>

      <button id="launchBtn" class="launch-btn">LAUNCH CLUTCH</button>
    </div>

    <script>
      const STATE = {
        IDLE: "IDLE",
        SEQUENCE: "SEQUENCE",
        READY: "READY",
        STARTED: "STARTED",
        ENDED: "ENDED",
      };
      let currentState = STATE.IDLE;
      let startTime = 0;
      let timers = [];

      const launchBtn = document.getElementById("launchBtn");
      const statusEl = document.getElementById("status");
      const lightPods = document.querySelectorAll(".light-pod");
      const themeToggle = document.getElementById("themeToggle");

      // 입력 처리 (클릭/터치/스페이스바)
      const handleInput = (e) => {
        if (e.type === "touchstart") e.preventDefault();

        if (currentState === STATE.IDLE || currentState === STATE.ENDED) {
          startSequence();
        } else if (
          currentState === STATE.SEQUENCE ||
          currentState === STATE.READY
        ) {
          triggerFalseStart();
        } else if (currentState === STATE.STARTED) {
          finishRace();
        }
      };

      launchBtn.addEventListener("mousedown", handleInput);
      launchBtn.addEventListener("touchstart", handleInput);
      document.addEventListener("keydown", (e) => {
        if (e.code === "Space") handleInput(e);
      });

      themeToggle.addEventListener("click", () =>
        document.body.classList.toggle("day-mode")
      );

      // 게임 로직
      function startSequence() {
        currentState = STATE.SEQUENCE;
        resetLights();
        statusEl.textContent = "";
        launchBtn.textContent = "HOLD...";
        launchBtn.style.borderColor = "#fff";
        launchBtn.style.color = "#fff";

        clearTimers();

        // 1초 간격으로 불 켜기
        for (let i = 0; i < 5; i++) {
          timers.push(
            setTimeout(() => {
              if (currentState !== STATE.SEQUENCE) return;
              turnOnPod(i);
              if (i === 4) {
                currentState = STATE.READY;
                // 5개 다 켜지면 0.2~3.0초 후 소등
                const randomDelay = Math.random() * 2800 + 200;
                timers.push(setTimeout(lightsOut, randomDelay));
              }
            }, (i + 1) * 1000)
          );
        }
      }

      function lightsOut() {
        if (currentState !== STATE.READY) return;
        setAllLights(false); // 소등
        startTime = performance.now();
        currentState = STATE.STARTED;
        launchBtn.textContent = "GO! GO! GO!";
        launchBtn.style.borderColor = "#00ff00";
        launchBtn.style.color = "#00ff00";
      }

      function finishRace() {
        const reactionTime = performance.now() - startTime;
        currentState = STATE.ENDED;
        statusEl.textContent = reactionTime.toFixed(3) + " MS";
        statusEl.className = "status-message success";
        launchBtn.textContent = "RESTART";
      }

      function triggerFalseStart() {
        clearTimers();
        currentState = STATE.ENDED;
        statusEl.textContent = "JUMP START";
        statusEl.className = "status-message penalty";
        launchBtn.textContent = "DISQUALIFIED";
        launchBtn.style.borderColor = "#ff0000";
        launchBtn.style.color = "#ff0000";

        // 깜빡임 효과
        let count = 0;
        const flash = setInterval(() => {
          count++;
          setAllLights(count % 2 === 0);
          if (count >= 6) {
            clearInterval(flash);
            setAllLights(false);
          }
        }, 150);
      }

      // 유틸리티 함수
      function turnOnPod(index) {
        const lights = lightPods[index].querySelectorAll(".light");
        lights.forEach((l) => l.classList.add("on"));
      }

      function setAllLights(isOn) {
        document.querySelectorAll(".light").forEach((l) => {
          if (isOn) l.classList.add("on");
          else l.classList.remove("on");
        });
      }

      function resetLights() {
        setAllLights(false);
      }
      function clearTimers() {
        timers.forEach((t) => clearTimeout(t));
        timers = [];
      }
    </script>
  </body>
</html>
