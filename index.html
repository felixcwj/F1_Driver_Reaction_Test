<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>F1 Reaction Test | Wide Track</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Titillium+Web:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        /* Tron Legacy Mode */
        --bg-sky: #000000;
        --bg-track: #050505;
        --neon-accent: #00f3ff; /* Tron Cyan */
        --neon-secondary: #ff5e00; /* Tron Orange */
        --text-color: #e0ffff;
        --light-off: #111;
        --light-red: #ff0000;
        --light-red-glow: 0 0 30px #ff0000, 0 0 60px #ff0000;
        --cockpit-border: #000;
      }

      body.day-mode {
        /* Day Mode (Optional, keeping structure) */
        --bg-sky: #87ceeb;
        --bg-track: #3a3a3a;
        --neon-accent: #ffffff;
      }

      * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; }

      body {
        font-family: "Titillium Web", sans-serif;
        height: 100vh; width: 100vw; overflow: hidden;
        background-color: var(--bg-sky);
        color: var(--text-color);
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        transition: background-color 0.5s ease;
      }

      /* --- 배경 (Digital Grid World) --- */
      .world-container {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        perspective: 600px; z-index: 1; overflow: hidden;
        background: radial-gradient(circle at 50% 30%, #111 0%, #000 80%);
      }

      .sky {
        position: absolute; top: 0; left: 0; width: 100%; height: 60%;
        background: linear-gradient(to bottom, #000 0%, #00111a 100%);
      }
      /* Digital Grid Sky */
      .sky::before {
        content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background: 
            linear-gradient(transparent 98%, rgba(0, 243, 255, 0.1) 99%),
            linear-gradient(90deg, transparent 98%, rgba(0, 243, 255, 0.1) 99%);
        background-size: 50px 50px;
        transform: perspective(500px) rotateX(60deg);
        opacity: 0.3;
      }

      /* --- Singapore Cityscape Graphics (Digital Wireframe) --- */
      .cityscape {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        pointer-events: none; z-index: 0; perspective: 1000px;
      }

      /* Generic Skyline */
      .skyline-far {
        position: absolute; bottom: 45%; left: 0; width: 100%; height: 20%;
        background: repeating-linear-gradient(90deg, #000 0px, #000 10px, rgba(0, 243, 255, 0.1) 10px, rgba(0, 243, 255, 0.1) 11px);
        opacity: 0.5;
        box-shadow: 0 0 20px rgba(0, 243, 255, 0.1);
      }

      /* Marina Bay Sands (MBS) - Wireframe */
      .mbs-complex {
        position: absolute; bottom: 45%; left: 60%; width: 120px; height: 150px; transform: scale(0.8);
      }
      .mbs-tower {
        position: absolute; bottom: 0; width: 25px; height: 100%;
        background: rgba(0, 20, 30, 0.8);
        border: 1px solid var(--neon-accent);
        box-shadow: 0 0 10px var(--neon-accent), inset 0 0 10px rgba(0, 243, 255, 0.2);
      }
      .mbs-tower.t1 { left: 0; height: 90%; transform: skewX(-5deg); }
      .mbs-tower.t2 { left: 35px; height: 95%; }
      .mbs-tower.t3 { left: 70px; height: 90%; transform: skewX(5deg); }
      
      .mbs-skypark {
        position: absolute; top: -10px; left: -20px; width: 160px; height: 20px;
        background: #000;
        border: 1px solid var(--neon-accent);
        border-radius: 10px 10px 50% 50%;
        transform: rotate(-5deg);
        box-shadow: 0 0 15px var(--neon-accent);
      }

      /* Singapore Flyer - Neon Wheel */
      .singapore-flyer {
        position: absolute; bottom: 45%; left: 20%; width: 100px; height: 100px;
        animation: rotateFlyer 60s linear infinite;
      }
      .flyer-rim {
        width: 100%; height: 100%;
        border: 2px solid var(--neon-secondary);
        border-radius: 50%;
        box-shadow: 0 0 15px var(--neon-secondary);
      }
      .flyer-spokes {
        position: absolute; top: 50%; left: 50%; width: 100%; height: 2px;
        background: var(--neon-secondary);
        transform: translate(-50%, -50%);
        box-shadow: 0 0 5px var(--neon-secondary);
      }
      .flyer-spokes::before, .flyer-spokes::after {
        content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: inherit;
      }
      .flyer-spokes::before { transform: rotate(60deg); }
      .flyer-spokes::after { transform: rotate(120deg); }

      @keyframes rotateFlyer { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

      /* Supertrees - Digital Flora */
      .supertrees { position: absolute; bottom: 45%; left: 75%; width: 80px; height: 100px; }
      .tree {
        position: absolute; bottom: 0; width: 8px; height: 60px;
        background: #000;
        border: 1px solid #d000ff;
        border-radius: 5px 5px 0 0;
        box-shadow: 0 0 10px #d000ff;
      }
      .tree::after {
        content: ''; position: absolute; top: -15px; left: -12px; width: 32px; height: 20px;
        border: 1px solid #d000ff; border-radius: 50%;
        box-shadow: 0 0 10px #d000ff;
      }
      .tree.t1 { left: 0; height: 50px; }
      .tree.t2 { left: 25px; height: 70px; z-index: 2; }
      .tree.t3 { left: 50px; height: 40px; }

      /* --- Track (The Grid) --- */
      .track-surface {
        position: absolute; bottom: -20%; left: 50%; width: 400%; height: 100%;
        transform: translateX(-50%) rotateX(80deg);
        background: 
            linear-gradient(transparent 0%, #000 100%),
            repeating-linear-gradient(0deg, transparent 0px, transparent 39px, var(--neon-accent) 40px),
            repeating-linear-gradient(90deg, transparent 0px, transparent 39px, var(--neon-accent) 40px);
        background-size: 100% 100%, 40px 40px, 40px 40px;
        background-color: #050505;
        box-shadow: 0 0 50px var(--neon-accent);
        clip-path: polygon(45% 0%, 55% 0%, 100% 100%, 0% 100%);
      }

      /* --- Barriers (Glass Walls) --- */
      .barrier-left, .barrier-right {
        position: absolute; top: 0; bottom: 0; width: 300px;
        background: linear-gradient(to bottom, rgba(0, 243, 255, 0.1), transparent);
        border-top: 2px solid var(--neon-accent);
        box-shadow: 0 0 20px var(--neon-accent);
      }
      .barrier-left {
        left: -25%; transform: rotateY(90deg) translateX(50%);
        border-right: 4px solid var(--neon-accent);
      }
      .barrier-right {
        right: -25%; transform: rotateY(-90deg) translateX(-50%);
        border-left: 4px solid var(--neon-accent);
      }

      .track-lines::before, .track-lines::after {
        content: ""; position: absolute; top: 0; bottom: 0; width: 10px;
        background: var(--neon-secondary);
        box-shadow: 0 0 20px var(--neon-secondary);
      }
      .track-lines::before { left: 10%; }
      .track-lines::after { right: 10%; }

      .center-line { display: none; } /* No center line in Tron grid */

      /* --- F1 Car Nose (Tron Light Cycle Style) --- */
      .f1-car-nose {
        position: absolute; bottom: -5%; left: 50%; transform: translateX(-50%);
        width: 400px; height: 300px; z-index: 50; pointer-events: none; perspective: 500px;
      }
      .nose-cone {
        position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);
        width: 120px; height: 100%;
        background: #000;
        border: 2px solid var(--neon-accent);
        clip-path: polygon(20% 0%, 80% 0%, 100% 100%, 0% 100%);
        box-shadow: 0 0 20px var(--neon-accent), inset 0 0 20px var(--neon-accent);
      }
      .nose-stripe {
        position: absolute; top: 10px; left: 50%; transform: translateX(-50%);
        width: 6px; height: 90%;
        background: #fff;
        box-shadow: 0 0 15px #fff;
      }
      .front-wing-left, .front-wing-right {
        position: absolute; bottom: 20px; width: 180px; height: 60px;
        background: rgba(0,0,0,0.8);
        border: 2px solid var(--neon-accent);
        box-shadow: 0 0 15px var(--neon-accent);
      }
      .front-wing-left { left: -100px; transform: skewX(20deg) rotate(-5deg); border-radius: 10px 0 0 10px; }
      .front-wing-right { right: -100px; transform: skewX(-20deg) rotate(5deg); border-radius: 0 10px 10px 0; }
      
      .suspension-left, .suspension-right {
        position: absolute; bottom: 100px; width: 150px; height: 8px;
        background: #111; border: 1px solid var(--neon-accent);
        box-shadow: 0 0 10px var(--neon-accent);
      }
      .suspension-left { left: -80px; transform: rotate(-20deg); transform-origin: right center; }
      .suspension-right { right: -80px; transform: rotate(20deg); transform-origin: left center; }
    </style>
  </head>
  <body>
    <div class="world-container">
      <div class="sky"></div>
      
      <!-- Singapore Cityscape -->
      <div class="cityscape">
        <div class="skyline-far"></div>
        <div class="mbs-complex">
          <div class="mbs-tower t1"></div>
          <div class="mbs-tower t2"></div>
          <div class="mbs-tower t3"></div>
          <div class="mbs-skypark"></div>
        </div>
        <div class="singapore-flyer">
          <div class="flyer-rim"></div>
          <div class="flyer-spokes"></div>
        </div>
        <div class="supertrees">
          <div class="tree t1"></div>
          <div class="tree t2"></div>
          <div class="tree t3"></div>
        </div>
      </div>
      <div class="track-surface">
        <div class="track-lines"></div>
        <div class="center-line"></div>
      </div>

      <!-- Side Barriers -->
      <div class="barrier-left"></div>
      <div class="barrier-right"></div>

      <!-- Billboards (Real Singapore GP Sponsors) -->
      <div class="billboard left-1 sponsor-sia"><span>SINGAPORE AIRLINES</span></div>
      <div class="billboard right-1 sponsor-rolex"><span>ROLEX</span></div>
      <div class="billboard left-2 sponsor-dhl"><span>DHL</span></div>
      <div class="billboard right-2 sponsor-heineken"><span>Heineken</span></div>
      <div class="billboard left-3 sponsor-aramco"><span>aramco</span></div>
      <div class="billboard right-3 sponsor-pirelli"><span>PIRELLI</span></div>

      <!-- Powerful Floodlights (Singapore Brightness) -->
      <div class="floodlight-glow"></div>
      <div class="overhead-lights">
        <!-- Main Track Lights -->
        <div class="light-beam lb-1"></div>
        <div class="light-beam lb-2"></div>
        <div class="light-beam lb-3"></div>
        <div class="light-beam lb-4"></div>
        <div class="light-beam lb-5"></div>
        <div class="light-beam lb-6"></div>
        
        <!-- Side Floodlights (Illuminating Barriers) -->
        <div class="side-light sl-left-1"></div>
        <div class="side-light sl-right-1"></div>
        <div class="side-light sl-left-2"></div>
        <div class="side-light sl-right-2"></div>
      </div>
      
      <!-- F1 Car Nose (POV) -->
      <div class="f1-car-nose">
        <div class="nose-cone">
          <div class="nose-tip"></div>
          <div class="nose-stripe"></div>
          <div class="team-logo-placeholder"></div>
        </div>
        <div class="front-wing-left"></div>
        <div class="front-wing-right"></div>
        <div class="suspension-left"></div>
        <div class="suspension-right"></div>
      </div>
    </div>

    <div class="cockpit-visor"></div>
    <div class="page-title">F1 REACTION TEST</div>

    <div class="theme-toggle" id="themeToggle">
      <span class="toggle-label">MODE</span>
      <div class="toggle-switch"><div class="toggle-knob"></div></div>
    </div>

    <div class="game-ui">
      <div class="info-panel">
        <div id="status" class="status-message"></div>
      </div>

      <div class="gantry">
        <div class="light-pod">
          <div class="light"></div>
          <div class="light"></div>
        </div>
        <div class="light-pod">
          <div class="light"></div>
          <div class="light"></div>
        </div>
        <div class="light-pod">
          <div class="light"></div>
          <div class="light"></div>
        </div>
        <div class="light-pod">
          <div class="light"></div>
          <div class="light"></div>
        </div>
        <div class="light-pod">
          <div class="light"></div>
          <div class="light"></div>
        </div>
      </div>

      <button id="launchBtn" class="launch-btn">LAUNCH CLUTCH</button>
    </div>

    <script>
      const STATE = {
        IDLE: "IDLE",
        SEQUENCE: "SEQUENCE",
        READY: "READY",
        STARTED: "STARTED",
        ENDED: "ENDED",
      };
      let currentState = STATE.IDLE;
      let startTime = 0;
      let timers = [];

      const launchBtn = document.getElementById("launchBtn");
      const statusEl = document.getElementById("status");
      const lightPods = document.querySelectorAll(".light-pod");
      const themeToggle = document.getElementById("themeToggle");

      // 입력 처리 (클릭/터치/스페이스바)
      const handleInput = (e) => {
        if (e.type === "touchstart") e.preventDefault();

        if (currentState === STATE.IDLE || currentState === STATE.ENDED) {
          startSequence();
        } else if (
          currentState === STATE.SEQUENCE ||
          currentState === STATE.READY
        ) {
          triggerFalseStart();
        } else if (currentState === STATE.STARTED) {
          finishRace();
        }
      };

      launchBtn.addEventListener("mousedown", handleInput);
      launchBtn.addEventListener("touchstart", handleInput);
      document.addEventListener("keydown", (e) => {
        if (e.code === "Space") handleInput(e);
      });

      themeToggle.addEventListener("click", () =>
        document.body.classList.toggle("day-mode")
      );

      // 게임 로직
      function startSequence() {
        currentState = STATE.SEQUENCE;
        resetLights();
        statusEl.textContent = "";
        launchBtn.textContent = "HOLD...";
        launchBtn.style.borderColor = "#fff";
        launchBtn.style.color = "#fff";

        clearTimers();

        // 1초 간격으로 불 켜기
        for (let i = 0; i < 5; i++) {
          timers.push(
            setTimeout(() => {
              if (currentState !== STATE.SEQUENCE) return;
              turnOnPod(i);
              if (i === 4) {
                currentState = STATE.READY;
                // 5개 다 켜지면 0.2~3.0초 후 소등
                const randomDelay = Math.random() * 2800 + 200;
                timers.push(setTimeout(lightsOut, randomDelay));
              }
            }, (i + 1) * 1000)
          );
        }
      }

      function lightsOut() {
        if (currentState !== STATE.READY) return;
        setAllLights(false); // 소등
        startTime = performance.now();
        currentState = STATE.STARTED;
        launchBtn.textContent = "GO! GO! GO!";
        launchBtn.style.borderColor = "#00ff00";
        launchBtn.style.color = "#00ff00";
      }

      function finishRace() {
        const reactionTime = performance.now() - startTime;
        currentState = STATE.ENDED;
        statusEl.textContent = reactionTime.toFixed(3) + " MS";
        statusEl.className = "status-message success";
        launchBtn.textContent = "RESTART";
      }

      function triggerFalseStart() {
        clearTimers();
        currentState = STATE.ENDED;
        statusEl.textContent = "JUMP START";
        statusEl.className = "status-message penalty";
        launchBtn.textContent = "DISQUALIFIED";
        launchBtn.style.borderColor = "#ff0000";
        launchBtn.style.color = "#ff0000";

        // 깜빡임 효과
        let count = 0;
        const flash = setInterval(() => {
          count++;
          setAllLights(count % 2 === 0);
          if (count >= 6) {
            clearInterval(flash);
            setAllLights(false);
          }
        }, 150);
      }

      // 유틸리티 함수
      function turnOnPod(index) {
        const lights = lightPods[index].querySelectorAll(".light");
        lights.forEach((l) => l.classList.add("on"));
      }

      function setAllLights(isOn) {
        document.querySelectorAll(".light").forEach((l) => {
          if (isOn) l.classList.add("on");
          else l.classList.remove("on");
        });
      }

      function resetLights() {
        setAllLights(false);
      }
      function clearTimers() {
        timers.forEach((t) => clearTimeout(t));
        timers = [];
      }
    </script>
  </body>
</html>
