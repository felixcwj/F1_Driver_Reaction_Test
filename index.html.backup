<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>F1 Start Reaction Test | Singapore GP Edition</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Titillium+Web:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Singapore Night Mode (Default) */
            --bg-sky: #050508;
            --bg-track: #1a1a1a;
            --floodlight-color: rgba(255, 255, 255, 0.8);
            --floodlight-glow: rgba(255, 255, 255, 0.4);
            --neon-accent: #00ffcc; /* Petronas/Singapore vibes */
            --text-color: #fff;
            --light-off: #222;
            --light-red: #ff0000;
            --light-red-glow: 0 0 30px #ff0000, 0 0 60px #ff0000;
            --cockpit-border: #080808;
            --ui-bg: rgba(0, 0, 0, 0.7);
        }

        body.day-mode {
            /* Monza Day Mode */
            --bg-sky: #87CEEB;
            --bg-track: #333;
            --floodlight-color: transparent;
            --floodlight-glow: transparent;
            --neon-accent: #e10600; /* Ferrari Red */
            --text-color: #fff;
            --light-off: #3a3a3a;
            --light-red: #ff0000;
            --light-red-glow: 0 0 10px #ff0000; /* Less glow in day */
            --cockpit-border: #111;
            --ui-bg: rgba(0, 0, 0, 0.5);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
            -webkit-user-select: none;
        }

        body {
            font-family: 'Titillium Web', sans-serif;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            background-color: var(--bg-sky);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: background-color 0.5s ease;
        }

        /* --- IMMERSIVE BACKGROUND (Track & Floodlights) --- */
        .world-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            perspective: 1000px;
            z-index: 1;
            overflow: hidden;
        }

        .track-surface {
            position: absolute;
            bottom: -50%;
            left: 50%;
            transform: translateX(-50%) rotateX(60deg) translateY(20%);
            transform-origin: 50% 100%;
            width: 80%;
            height: 120%;
            background: linear-gradient(to bottom, var(--bg-track) 0%, #000 100%);
            box-shadow: inset 0 0 100px #000;
            clip-path: polygon(30% 0%, 70% 0%, 100% 100%, 0% 100%);
        }

        /* Neon Track Lanes - Inverted V (ã…… shape) */
        .track-lanes {
            position: absolute;
            bottom: -50%;
            left: 50%;
            transform: translateX(-50%) rotateX(60deg) translateY(20%);
            transform-origin: 50% 100%;
            width: 80%;
            height: 120%;
            z-index: 2;
        }

        /* Left lane line */
        .track-lanes::before {
            content: '';
            position: absolute;
            top: 0;
            left: 35%;
            width: 3px;
            height: 100%;
            background: linear-gradient(to bottom, var(--neon-accent) 0%, transparent 100%);
            box-shadow: 0 0 10px var(--neon-accent), 0 0 20px var(--neon-accent);
            transform-origin: top;
            transform: skewX(-15deg);
        }

        /* Right lane line */
        .track-lanes::after {
            content: '';
            position: absolute;
            top: 0;
            right: 35%;
            width: 3px;
            height: 100%;
            background: linear-gradient(to bottom, var(--neon-accent) 0%, transparent 100%);
            box-shadow: 0 0 10px var(--neon-accent), 0 0 20px var(--neon-accent);
            transform-origin: top;
            transform: skewX(15deg);
        }

        /* Floodlights (Singapore Vibe) - Multiple colorful beams */
        .floodlight-beam {
            position: absolute;
            bottom: 30%;
            width: 150px;
            height: 300px;
            opacity: 0.4;
            filter: blur(40px);
            pointer-events: none;
        }

        .floodlight-beam:nth-child(1) {
            left: 5%;
            background: linear-gradient(to top, transparent, rgba(0, 255, 204, 0.6));
            transform: rotate(-10deg);
        }

        .floodlight-beam:nth-child(2) {
            left: 15%;
            background: linear-gradient(to top, transparent, rgba(255, 0, 255, 0.5));
            transform: rotate(-5deg);
        }

        .floodlight-beam:nth-child(3) {
            right: 5%;
            background: linear-gradient(to top, transparent, rgba(0, 255, 204, 0.6));
            transform: rotate(10deg);
        }

        .floodlight-beam:nth-child(4) {
            right: 15%;
            background: linear-gradient(to top, transparent, rgba(255, 100, 0, 0.5));
            transform: rotate(5deg);
        }

        body.day-mode .floodlight-beam {
            opacity: 0;
        }

        /* Sky Gradient */
        .sky {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 60%;
            background: linear-gradient(to bottom, var(--bg-sky) 0%, transparent 100%);
            z-index: 0;
        }

        /* --- COCKPIT VISOR OVERLAY --- */
        .cockpit-visor {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 100;
            pointer-events: none;
            /* The Visor Shape */
            background: radial-gradient(
                ellipse at center, 
                transparent 55%, 
                rgba(0,0,0,0.2) 60%, 
                var(--cockpit-border) 75%
            );
            box-shadow: inset 0 0 50px rgba(0,0,0,0.8);
        }
        
        /* Top Strip of Helmet */
        .cockpit-visor::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 12%;
            background: var(--cockpit-border);
            border-bottom: 3px solid #333;
            border-bottom-left-radius: 50% 20%;
            border-bottom-right-radius: 50% 20%;
        }

        /* Bottom Chin Bar */
        .cockpit-visor::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 20%;
            background: var(--cockpit-border);
            border-top: 3px solid #333;
            border-top-left-radius: 40% 30%;
            border-top-right-radius: 40% 30%;
        }

        /* --- GAME UI --- */
        .game-ui {
            position: relative;
            z-index: 50;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            width: 100%;
            height: 100%;
            padding-top: 15vh; /* Move lights higher for helmet POV */
        }

        /* F1 START LIGHTS GANTRY */
        .gantry {
            display: flex;
            gap: 15px;
            background: #111;
            padding: 20px 30px;
            border-radius: 10px;
            border: 2px solid #333;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
            margin-bottom: 40px;
            transform: perspective(800px) rotateX(5deg);
        }

        .light-pod {
            display: flex;
            flex-direction: column;
            gap: 8px;
            background: #000;
            padding: 8px;
            border-radius: 8px;
            border: 1px solid #333;
        }

        .light {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--light-off);
            border: 2px solid #000;
            position: relative;
            transition: background-color 0.05s, box-shadow 0.05s;
        }

        /* Inner reflection for realism */
        .light::after {
            content: '';
            position: absolute;
            top: 10%;
            left: 20%;
            width: 30%;
            height: 30%;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
        }

        .light.on {
            background-color: var(--light-red);
            box-shadow: var(--light-red-glow);
        }

        /* CONTROLS & INFO */
        .info-panel {
            text-align: center;
            margin-bottom: 30px;
        }

        /* Title - Top Left */
        .page-title {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 200;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 5px var(--neon-accent);
            opacity: 0.9;
        }

        .status-message {
            font-family: 'Orbitron', sans-serif;
            font-size: 3rem;
            font-weight: 700;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 2px 2px 0 #000;
        }

        .status-message.success { color: #00ff00; text-shadow: 0 0 20px #00ff00; }
        .status-message.penalty { color: #ff0000; text-shadow: 0 0 20px #ff0000; animation: shake 0.5s; }
        .status-message.waiting { color: #ffff00; }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            50% { transform: translateX(10px); }
            75% { transform: translateX(-10px); }
            100% { transform: translateX(0); }
        }

        /* LAUNCH BUTTON (Steering Wheel Style) */
        .launch-btn {
            background: linear-gradient(145deg, #333, #111);
            color: #fff;
            border: 2px solid #555;
            padding: 20px 60px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5), inset 0 2px 0 rgba(255,255,255,0.1);
            transition: all 0.1s;
            outline: none;
            position: relative;
            overflow: hidden;
        }

        .launch-btn:active {
            transform: translateY(4px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
            background: #000;
        }

        /* Neon glow on hover/active based on theme */
        .launch-btn:hover {
            border-color: var(--neon-accent);
            box-shadow: 0 0 15px var(--neon-accent);
        }

        /* THEME TOGGLE */
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 200; /* Above visor */
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(0,0,0,0.5);
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid #444;
            cursor: pointer;
        }

        .toggle-switch {
            width: 40px;
            height: 20px;
            background: #333;
            border-radius: 10px;
            position: relative;
            transition: background 0.3s;
        }

        .toggle-knob {
            width: 16px;
            height: 16px;
            background: #fff;
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: transform 0.3s;
        }

        .active .toggle-switch { background: var(--neon-accent); }
        .active .toggle-knob { transform: translateX(20px); }

        .toggle-label {
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        /* MOBILE RESPONSIVENESS */
        @media (max-width: 600px) {
            .gantry { gap: 5px; padding: 10px; margin-bottom: 30px; }
            .light { width: 35px; height: 35px; }
            .page-title { font-size: 0.8rem; }
            .status-message { font-size: 2rem; }
            .launch-btn { padding: 15px 40px; font-size: 1.2rem; }
            .floodlights-left, .floodlights-right { width: 10px; }
        }
    </style>
</head>
<body>

    <!-- IMMERSIVE BACKGROUND -->
    <div class="world-container">
        <div class="sky"></div>
        <div class="track-surface"></div>
        <div class="track-lanes"></div>
        <div class="floodlight-beam"></div>
        <div class="floodlight-beam"></div>
        <div class="floodlight-beam"></div>
        <div class="floodlight-beam"></div>
    </div>

    <!-- COCKPIT OVERLAY -->
    <div class="cockpit-visor"></div>

    <!-- TITLE -->
    <div class="page-title">F1 REACTION TEST</div>

    <!-- THEME TOGGLE -->
    <div class="theme-toggle" id="themeToggle">
        <span class="toggle-label">MODE</span>
        <div class="toggle-switch">
            <div class="toggle-knob"></div>
        </div>
    </div>

    <!-- GAME UI -->
    <div class="game-ui">
        <div class="info-panel">
            <div id="status" class="status-message"></div>
        </div>

        <div class="gantry">
            <!-- 5 Light Pods -->
            <div class="light-pod"><div class="light"></div><div class="light"></div></div>
            <div class="light-pod"><div class="light"></div><div class="light"></div></div>
            <div class="light-pod"><div class="light"></div><div class="light"></div></div>
            <div class="light-pod"><div class="light"></div><div class="light"></div></div>
            <div class="light-pod"><div class="light"></div><div class="light"></div></div>
        </div>

        <button id="launchBtn" class="launch-btn">LAUNCH CLUTCH</button>
    </div>

    <script>
        // --- GAME STATE & CONSTANTS ---
        const STATE = {
            IDLE: 'IDLE',
            SEQUENCE: 'SEQUENCE', // Lights turning on
            READY: 'READY',       // All lights on, waiting for random delay
            STARTED: 'STARTED',   // Lights out, timer running
            ENDED: 'ENDED'        // Result shown
        };

        let currentState = STATE.IDLE;
        let startTime = 0;
        let sequenceTimeouts = [];
        let randomDelayTimeout = null;

        // --- DOM ELEMENTS ---
        const launchBtn = document.getElementById('launchBtn');
        const statusEl = document.getElementById('status');
        const lightPods = document.querySelectorAll('.light-pod');
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;

        // --- AUDIO CONTEXT (Optional for future, strict visual requirement for now) ---

        // --- EVENT LISTENERS ---
        launchBtn.addEventListener('mousedown', handleInput); // Use mousedown for faster reaction than click
        launchBtn.addEventListener('touchstart', (e) => { e.preventDefault(); handleInput(); }); // Mobile optimization
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault(); // Prevent scrolling
                handleInput();
            }
        });

        themeToggle.addEventListener('click', () => {
            body.classList.toggle('day-mode');
            themeToggle.classList.toggle('active');
        });

        // --- CORE LOGIC ---

        function handleInput() {
            switch (currentState) {
                case STATE.IDLE:
                case STATE.ENDED:
                    startSequence();
                    break;
                case STATE.SEQUENCE:
                case STATE.READY:
                    triggerFalseStart();
                    break;
                case STATE.STARTED:
                    finishRace();
                    break;
            }
        }

        function startSequence() {
            // Reset Game
            currentState = STATE.SEQUENCE;
            resetLights();
            statusEl.textContent = '';
            statusEl.className = 'status-message';
            launchBtn.textContent = 'HOLD...';
            launchBtn.style.borderColor = '#fff';

            // Clear any existing timers
            clearAllTimers();

            // FIA Sequence: 5 lights, 1 second interval
            // Light 1: 0s (Immediate? No, usually 1s after board reset. We'll start 1s after click)
            
            for (let i = 0; i < 5; i++) {
                let t = setTimeout(() => {
                    if (currentState !== STATE.SEQUENCE) return;
                    turnOnPod(i);
                    
                    // After 5th light (index 4), move to READY
                    if (i === 4) {
                        currentState = STATE.READY;
                        startRandomDelay();
                    }
                }, (i + 1) * 1000); // 1000ms, 2000ms, 3000ms, 4000ms, 5000ms
                sequenceTimeouts.push(t);
            }
        }

        function startRandomDelay() {
            // FIA Rule: 0.2s to 3.0s after 5th light
            const delay = Math.random() * 2800 + 200; // 200ms to 3000ms
            
            randomDelayTimeout = setTimeout(() => {
                if (currentState !== STATE.READY) return;
                lightsOut();
            }, delay);
        }

        function lightsOut() {
            setAllLights(false);
            startTime = performance.now();
            currentState = STATE.STARTED;
            launchBtn.textContent = 'GO! GO! GO!';
            launchBtn.style.borderColor = '#00ff00';
        }

        function finishRace() {
            const endTime = performance.now();
            const reactionTime = endTime - startTime;
            currentState = STATE.ENDED;
            
            const formattedTime = reactionTime.toFixed(3);
            statusEl.textContent = `${formattedTime} MS`;
            statusEl.className = 'status-message success';
            launchBtn.textContent = 'RESTART';
        }

        function triggerFalseStart() {
            clearAllTimers();
            currentState = STATE.ENDED;
            
            statusEl.textContent = 'JUMP START';
            statusEl.className = 'status-message penalty';
            launchBtn.textContent = 'DISQUALIFIED';
            launchBtn.style.borderColor = '#ff0000';

            // Abort sequence visuals
            // Keep lights on or flash them? Usually jump start means you moved before lights out.
            // Let's flash all lights to indicate error.
            flashLights();
        }

        // --- HELPERS ---

        function turnOnPod(index) {
            const pod = lightPods[index];
            const lights = pod.querySelectorAll('.light');
            lights.forEach(l => l.classList.add('on'));
        }

        function setAllLights(on) {
            lightPods.forEach(pod => {
                const lights = pod.querySelectorAll('.light');
                lights.forEach(l => {
                    if (on) l.classList.add('on');
                    else l.classList.remove('on');
                });
            });
        }

        function resetLights() {
            setAllLights(false);
        }

        function flashLights() {
            let count = 0;
            const flashInterval = setInterval(() => {
                count++;
                const isOn = count % 2 === 0;
                setAllLights(!isOn); // Toggle
                if (count >= 6) {
                    clearInterval(flashInterval);
                    setAllLights(false); // End off
                }
            }, 150);
        }

        function clearAllTimers() {
            sequenceTimeouts.forEach(t => clearTimeout(t));
            sequenceTimeouts = [];
            if (randomDelayTimeout) clearTimeout(randomDelayTimeout);
        }

    </script>
</body>
</html>
